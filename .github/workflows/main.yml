name: Windows - RustDesk SSD Setup

on:
  workflow_dispatch:

jobs:
  rustdesk-install:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: ğŸ§¾ Sistem Bilgisi YazdÄ±r
        shell: pwsh
        run: |
          systeminfo
          Get-PSDrive C

      - name: ğŸ“¦ RustDesk Ä°ndir ve Kur (C:\ SSD)
        shell: pwsh
        run: |
          $installPath = "C:\Program Files\RustDesk"
          $installerPath = "$env:TEMP\rustdesk-installer.exe"

          # KlasÃ¶r yoksa oluÅŸtur
          if (!(Test-Path $installPath)) {
              New-Item -ItemType Directory -Path $installPath | Out-Null
          }

          # GitHub API'den en son sÃ¼rÃ¼mÃ¼ al
          $latest = Invoke-RestMethod -Uri "https://api.github.com/repos/rustdesk/rustdesk/releases/latest"
          $version = $latest.tag_name.TrimStart("v")
          Write-Output "ğŸ“Œ SÃ¼rÃ¼m: $version"

          # Kurulum dosyasÄ±nÄ± indir
          $url = "https://github.com/rustdesk/rustdesk/releases/download/v$version/rustdesk-$version-windows_x64-installer.exe"
          Invoke-WebRequest -Uri $url -OutFile $installerPath

          # Sessizce kur
          Start-Process -FilePath $installerPath -ArgumentList "/VERYSILENT /DIR=""$installPath""" -Wait

      - name: ğŸš€ BaÅŸlangÄ±ca Eklenmesini SaÄŸla
        shell: pwsh
        run: |
          $exePath = "C:\Program Files\RustDesk\rustdesk.exe"
          $startupFolder = "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup"
          $shortcut = "$startupFolder\rustdesk.lnk"

          if (Test-Path $exePath) {
              $shell = New-Object -ComObject WScript.Shell
              $shortcutObject = $shell.CreateShortcut($shortcut)
              $shortcutObject.TargetPath = $exePath
              $shortcutObject.Save()
              Write-Output "âœ… RustDesk baÅŸlangÄ±ca eklendi"
          } else {
              Write-Output "âŒ rustdesk.exe bulunamadÄ±"
          }

      - name: ğŸ†” RustDesk ID (Varsa)
        shell: pwsh
        run: |
          $configPath = "$env:APPDATA\RustDesk\config\RustDesk.toml"
          if (Test-Path $configPath) {
              Get-Content $configPath
          } else {
              Write-Output "ğŸ•’ RustDesk ID henÃ¼z oluÅŸmamÄ±ÅŸ olabilir. Ä°lk aÃ§Ä±lÄ±ÅŸta oluÅŸturulur."
          }

      - name: â³ SayaÃ§ (KapanmasÄ±n)
        shell: pwsh
        run: |
          for ($i = 1; $i -le 9999; $i++) {
              Write-Output "â±ï¸ Bekleniyor: $i dakika"
              Start-Sleep -Seconds 60
          }
